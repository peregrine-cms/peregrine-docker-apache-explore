branches:
  only:
  - master
services:
- docker
env:
  global:
  - DOCKER_IMAGE_APACHE_LIVE=peregrinecms/apache-live
  - DOCKER_IMAGE_APACHE_STAGE=peregrinecms/apache-stage
  - DOCKER_USERNAME=gastongonzalez
  matrix:
  - secure: x21cQdxtCEHV9BrGPmP+FzaraSoRbTAty2DDeNbycAjcJZsJt4hMcUy5tOBShCY2o/IlF6jVDHmDo3inRPbPQvhop9b4iK3vSfnzfk1cT+K2/TJw9r0ZtWS55A2nkxkG6QidJE03Oc557MY1ouJX5JTSoAm2FO5AQ+AOXorxtwSpBCGQTHGNOmRhV6CayerReaqoG8zEiVLin/uRf/vv0IqyW86vSe5mQWCRIK0V4Rjm1E8so9y/yjTxDU4KazTN6+Yu37m70pV3J42OcNr1nfF7tMjqu9RLUtxArDzmGPMKuAXYisq6tARkcB5MRZ1xVT0u25IFEKLyBYySbjMeD/fF3gra4yCnijnqGraYeXQ2IdPxf/5kcrtt85OMRG4OV3KDCrCOt64yX0t254UWccD1xN5nWm8ht61gAcpvZ8/yy/bD1MKeJvWBCpMYG5MblO33da78sMO0yY8ziSO0wO7fLx0b/0wspfz7dSlXo8FKKgj/+xKUnmi0ZWnhxwvi5fhvJIBANwmdE5Tmcy+OtgbhRoMfNHIQv3Bwqdolpp9Z8ROQxGnpUd4W4qUGz1UoO49DCwAEUz/j7E4zZKJyG4U+ZyHcFotN1KTCXkxR5O/d2Nej1jAL0fQWzuk2pAGsBkQAAbvcHtJIkmK5hCxXm3wVK9S/Cii68zfIb8QUudI=
  - secure: oQgFaxbgIuv9IhEOgz84Jiya7kiuK+h15qW0qCv6cEs7gdD249vzz9MtaY4g8K7cHiur5U2WnwRFafCRlY+ifbi1Z6uysYD6xjiPTy5mdLPVnA8U+vMaN+bjHloprqkqt45rVr+tK0Ii5b7DvaQSHJ5QimTs6OwvilNr9T/rUGLbBw1Ukfs2YhhTzdkajdXi2osCbGxpRDw65gjsq/FRXKtPVRNJ9bZUBmpr7mb48wGssTQgXkZ+s8zCQ7O8dVFMMwcPQJUihR7n/7y1WfMf9V5UsdVuVoGzNYc5lp/alSw5L4DWwsBqLcDOAOQTpCFT5t+xOPh7dsuunDWXHLvPhs4JooH6Qrly5S8CB6xVsK4tHzPWCpDXKQilaLY/yIEohhadepCzyZ10vfA9feKaT7HTDqGSULw42I2ksaRkOp3l9YrLCAumXQm7fyV6Mro/uDm3QuK81wkoJC3OUuWaoR0UXE2L75KKPcT5aARlDGHQ2Nifg9NjmULBNkGGKpRhZDMejSr9urDb9GUDEoULNWMpEPw3BjiIO5nJdIxi14FIrGHVydXphNULb2wNcYZgruf9jyOc9UtG4wAXdNBxK/9eaHypibo2Yb9FMPRrAFaw+RY8dmaDSxl85uELVZtXe+6EC1UxZHDMAA6z1+vHEfW/sLBG+JY59e/pCzQKGjE=
before_script:
- branch="$(echo ${TRAVIS_BRANCH} | tr '/' '-' | tr '[:upper:]' '[:lower:]')"
script:
- cd live && ./build.sh && cd ../stage && ./build.sh
after_script:
- docker images
before_deploy:
- docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
- docker tag "$DOCKER_IMAGE_APACHE_LIVE" "${DOCKER_IMAGE_APACHE_LIVE}:latest"
- docker tag "$DOCKER_IMAGE_APACHE_STAGE" "${DOCKER_IMAGE_APACHE_STAGE}:latest"
deploy:
  provider: script
  script: docker push ${DOCKER_IMAGE_APACHE_LIVE}:latest && docker push ${DOCKER_IMAGE_APACHE_STAGE}:latest
  on:
    branch: master
