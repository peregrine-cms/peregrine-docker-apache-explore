<VirtualHost *:80>

    Protocols h2 http/1.1

    ModPagespeedEnableCachePurge on
    ModPagespeedPurgeMethod PURGE

    SetOutputFilter DEFLATE
    ExpiresDefault "access plus 1 month"
    ExpiresActive On

    ServerAdmin webmaster@${APACHE_DOMAIN}
    DocumentRoot "/var/www/html"
    ServerName ${APACHE_DOMAIN}
    ErrorLog "${APACHE_LOG_DIR}/${APACHE_DOMAIN}-error_log"
    CustomLog "${APACHE_LOG_DIR}/${APACHE_DOMAIN}-access_log" common

    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

    RewriteEngine On

    # Prevent HTTP POST requests
    RewriteCond %{REQUEST_METHOD} POST
    RewriteRule ^ - [R=403,NC,L]

    # Add support for robots.txt at root of site
    RewriteRule "robots.txt$" /content/sites/${PEREGRINE_SITE}/robots.txt [PT]

    # Redirect to home page
    RewriteRule "^/$" /content/sites/${PEREGRINE_SITE}/index.html [R=301,L]
    RewriteRule "^/content/sites/${PEREGRINE_SITE}$" /content/sites/${PEREGRINE_SITE}/index.html [R=301,L]

    ProxyRequests Off
    ProxyPreserveHost On

    ProxyPass          /       ${APACHE_PROXY_URL}
    ProxyPassReverse   /       ${APACHE_PROXY_URL}

</VirtualHost>
